# NxDojo

<a alt="Nx logo" href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>

✨ **This workspace has been generated by [Nx, a Smart, fast and extensible build system.](https://nx.dev)** ✨

## Instructions

This repository is a coding dojo to give you a taste of what it's like to work with Nx, making your code modular and scalable.

### Prerequisites

Before starting you have to decide if you want to use `npm` or `pnpm`: in fact, the workspace feature used to create packages behaves differently depending on the package manager you use.

### Getting started

- Create a folder called packages. This will be used as root for our workspaces.
- Configure npm to use this folder, adding the following to your package.json file:

```json
"workspaces": [
    "packages/*"
  ]
```

- Configure pnpm to use this folder, creating a `pnpm-workspace.yaml` file with the following content:

```yaml
packages:
  - "packages/*"
```

### Creating our first package: is-even

- Create a new folder called `is-even` inside packages (Nx workspace)
- Create a new index.ts file:

```ts
export const isEven = (n: number) => n % 2 === 0;
```

- Create a package.json
  ```json
  {
    "name": "@nx-dojo/is-even",
    "version": "0.0.1",
    "main": "index.ts",
    "devDependencies": {
      "typescript": "^5.2.2"
    },
    "license": "MIT"
  }
  ```
- Add the following script to your package.json file:
  ```json
  "scripts": {
      "build": "tsc"
  }
  ```
- Install the dependencies inside the package folder:
  ```bash
  npm install
  ```
- Build the package:
  ```bash
  npx nx build is-even
  ```

### Create a new package called is-odd, which will depend on is-even.

- Create a new folder called `is-odd` inside packages (Nx workspace)
- Create the package.json:
  ```json
  {
    "name": "@nx-dojo/is-odd",
    "version": "0.0.1",
    "main": "index.ts",
    "devDependencies": {
      "typescript": "^5.2.2"
    },
    "dependencies": {
      "@nx-dojo/is-even": "workspace:@nx-dojo/is-even"
    },
    "license": "MIT"
  }
  ```
  > **_NOTE:_** `@nx-dojo/is-even": "workspace:@nx-dojo/is-even` is required by pnpm, while it is not supported by npm that uses the root package.json file instead.
  > So, if you use NPM, removes this line.
- Create a new index.ts file:

  ```ts
  import { isEven } from "@nx-dojo/is-even";
  export const isOdd = (n: number) => !isEven(n);
  ```

- Build the package:
  ```bash
  npx nx build is-odd
  ```

### Create a file using these packages

- Create a new index.ts file in the root, importing the packages and using them:

  ```ts
  import { isEven } from "@nx-dojo/is-even";
  import { isOdd } from "@nx-dojo/is-odd";

  console.log(isEven(2));
  console.log(isOdd(2));
  ```

- If you use **_pnpm_**, update the root package.json adding:

  ```json
  "dependencies": {
    "@nx-dojo/is-even": "workspace:@nx-dojo/is-even",
    "@nx-dojo/is-odd": "workspace:@nx-dojo/is-odd"
  }
  ```

- Update the root package.json adding `run` and `build` scripts:

  ```json
    "scripts": {
      "build": "tsc index.ts --outDir dist",
      "run": "node dist/index.js"
    }

  ```

- Update the `targetDefaults` section of nx.json file to configure the NX start task:

  ```json
    "start": {
      "dependsOn": ["build"]
    }
  ```

- Run the following command to build the packages:
  ```bash
    npx nx start nx-dojo
  ```

### Final structure

Your project should seem like this:

```
  nx-dojo/
  ├── packages/
  │ ├── is-even/
  │ │ ├── index.ts
  │ │ └── package.json
  │ └── is-odd/
  │ ├── index.ts
  │ └── package.json
  ├── nx.json
  ├── index.ts
  └── package.json
```

## Advantage using workspaces

- **_Shared dependencies_**: you can separate your code into multiple packages, in favor of modularity and scalability.

## Advantage using NX

- **_Faster builds_**: Nx will only build the packages that have changed, so you can save time.
- **_Code generation_**: Nx can generate the code for you, so you can focus on the business logic.
- **_Code boundaries_**: Nx will enforce the boundaries between your packages, so you can avoid spaghetti code.
